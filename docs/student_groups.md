## Студенческие группы

Концепция студенческой группы очень простая - это подмножество всех студентов определенного курса.
У группы есть название и ответственные.

Каждый студент должен состоять в группе, но только одной, пересечений групп по студентам не предусмотрено.
В момент записи на курс принимается решение, в какую группу поместить студента.
Для принятия решения существует 2 режима работы студенчески групп курса.
Режим работы может быть указан в настройках курса только в момент его создания.
После создания курса только по запросу.

### Режим студенческих групп "Отделение"

Режим полностью автоматизирован и занимается распределением студентов курса по отделениям, доступных в рамках курса.

При добавлении нового отделения, для которого доступен курс, создаётся студенческая группа, связанная с этим отделением (название группы совпадает с названием отделения).

Далее, в момент записи на курс, смотрим отделение студента (берётся из его текущего студенческого профиля) и связываем студента с соответствующей группой-отделением.

Записать студента на курс, если его домашнего отделения (то, которое указано в его студенческом профиле) нет среди доступных в рамках курса, можно только через админку. В этом случае на лету будет создана студенческая группа "Другие" и все студенты, для которых не найдена группа-отделение, будут попадать в эту системную группу.

### Режим студенческих групп "Ручной"

Здесь нет никакой скрытой логики, за исключением того, что нам нужна группа по умолчанию, в которую будут попадать студенты при записи на курс.
Она, как и в случае с режимом "Отделение", создаётся автоматически при записи студентов на курс.

Через публичный интерфейс преподаватели могут создавать необходимые им группы и перекидывать студентов из групп в целевые.

## Ответственные за студенческую группу

Ответственный за студенческую группу - это преподаватель, который будет назначен проверяющим, если студент проявил активность в каком-либо задании (отправил комментарий или решение к заданию), но только при условии, что к этому моменту проверяющий ещё не назначен (один из преподавателей уже мог указать себя проверяющим по какой-либо причине).

Когда преподаватель указан в качестве проверяющего задание конкретного студента, то только он получает уведомления об активности студента.

Публичный интерфейс сейчас позволяет назначать только одного ответственного.

Note: Через админку есть техническая возможность задать несколько ответственных, но нужно учитывать, что список будет сброшен, 
если уже после добавления нескольких ответственных отредактировать студенческую группу через публичный интерфейс.
Если указано несколько ответственных, то проверяющий автоматически не назначается, т.к. не совсем ясно, кто из них должен им быть (логика "ответственный среди ответственных", который будет перевешивать студентов на других ответственных, сводится к указанию одного ответственного, т.е. ненужное усложнение).
Как следствие, все ответственные студенческой группы будут получать уведомления (вместо всех проверяющих ДЗ, указанных в настройках курса), до тех пор, пока кто-то из них не заберёт студента себе, указав себя в качестве проверяющего на странице проверки задания.

## Логика отправки уведомлений об активности студента в задании

Если назначен проверяющий, то только он получит email-уведомления, но только если для него не отключены нотификации в настройках курса.

TODO: можно поддержать список watchers для всех желающих отслеживать активность проверки задания.
Например, куратор подписывается на обновления проблемного студента.

Если проверяющий не назначен:

1. Возьмём студенческую группу, с которой связан студент. Если у группы указаны ответственные, то запоминаем их и прекращаем поиск.
2. Если ответственные не указаны, то берём список проверяющих ДЗ из настроек задания.
   Этот список формируется в момент создания задания - так мы запоминаем текущий (на момент создания) список проверяющих ДЗ (копируем из настроек курса) и позволяем кастомизировать этот список через админку.
   Note: Все новые проверяющие автоматически добавляются в настройки существующих заданий.

Как только мы получили список преподавателей, которые должны получить уведомления, мы проверяем их желание получать эти уведомления в настройках курса - если нотификации не отключены, то формируем сообщение преподавателю и отправляем.


TODO: описать, в каких случаях мы не можем перекидывать студентов между группами
